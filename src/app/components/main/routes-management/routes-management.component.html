<div class="ct_right_dash_content">
    <div class="container">
        <div class="header">
            <h1>Stops and Lines</h1>
            <p>Manage all stops and lines that your company operates.</p>
            <p class="breadcrumb">Home / Bus Schedule / Stops and Lines</p>
        </div>

        <div class="content row">
            <!-- Lines Section -->
            <div class="col-md-6 lines-section">
                <div class="d-flex justify-content-between align-items-center mb-3">
                    <h3>Lines</h3>
                    <button class="btn btn-primary" routerLink="/home/new-route">+ Add New
                        Line</button>
                </div>
                <p>View and manage lines. Click on a line to view and edit details, manage departure times.</p>

                <div class="accordion" id="linesAccordion">
                    <div class="accordion-item" *ngFor="let line of lines">
                        <h2 class="accordion-header" id="heading{{ line.route_id }}">
                            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
                                [attr.data-bs-target]="'#collapse' + line.route_id" aria-expanded="false"
                                [attr.aria-controls]="'collapse' + line.route_id">
                                {{ line.route_direction }}
                            </button>
                        </h2>
                        <div id="collapse{{ line.route_id }}" class="accordion-collapse collapse"
                            [attr.aria-labelledby]="'heading'+ line.route_id " data-bs-parent="#linesAccordion">
                            <div class="accordion-body">
                                <!-- Content inside the collapse -->
                                <div>
                                    <p *ngFor="let stop of line.route_stops.slice(0,1)"
                                        class="d-flex align-items-center gap-1 m-2">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18"
                                            viewBox="0 0 24 24">
                                            <g fill="currentColor">
                                                <path
                                                    d="m14.829 11.948l1.414-1.414L12 6.29l-4.243 4.243l1.415 1.414L11 10.12v7.537h2V10.12z" />
                                                <path fill-rule="evenodd"
                                                    d="M19.778 4.222c-4.296-4.296-11.26-4.296-15.556 0s-4.296 11.26 0 15.556s11.26 4.296 15.556 0s4.296-11.26 0-15.556m-1.414 1.414A9 9 0 1 0 5.636 18.364A9 9 0 0 0 18.364 5.636"
                                                    clip-rule="evenodd" />
                                            </g>
                                        </svg>
                                        <strong>From:</strong>{{
                                        stop.stop_city.city_name }}
                                    </p>
                                    <ul class="p-0 m-2">
                                        <li *ngFor="let stop of line.route_stops.slice(1, line.route_stops?.length-1)"
                                            class="d-flex align-items-center gap-1">
                                            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20"
                                                viewBox="0 0 24 24">
                                                <path fill="currentColor"
                                                    d="M19 9A7 7 0 1 0 5 9c0 1.387.409 2.677 1.105 3.765h-.008L12 22l5.903-9.235h-.007A6.97 6.97 0 0 0 19 9m-7 3a3 3 0 1 1 0-6a3 3 0 0 1 0 6" />
                                            </svg> {{ stop.stop_city.city_name }}
                                        </li>
                                    </ul>
                                    <p *ngFor="let stop of line.route_stops.slice(line.route_stops?.length-1, line.route_stops?.length)"
                                        class="d-flex align-items-center gap-1 m-2">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18"
                                            viewBox="0 0 24 24">
                                            <g fill="currentColor">
                                                <path
                                                    d="m14.829 12.026l1.414 1.414L12 17.683L7.757 13.44l1.415-1.414L11 13.854V6.317h2v7.537z" />
                                                <path fill-rule="evenodd"
                                                    d="M19.778 19.778c-4.296 4.296-11.26 4.296-15.556 0s-4.296-11.26 0-15.556s11.26-4.296 15.556 0s4.296 11.26 0 15.556m-1.414-1.414A9 9 0 1 1 5.636 5.636a9 9 0 0 1 12.728 12.728"
                                                    clip-rule="evenodd" />
                                            </g>
                                        </svg>
                                        <strong>To:</strong> {{ stop.stop_city.city_name }}
                                    </p>
                                    <p><strong>Departure time:</strong> {{ line.route_stops[0]?.departure_time }}</p>
                                    <div class="d-flex justify-content-between align-items-center">
                                        <button routerLink="/home/new-route" [queryParams]="{'route_id':line.route_id}"
                                            class="ct_blue_btn ct_outline_btn_blue py-2 h-auto ct_fs_16 ct_fw_500 ct_white_nowrap w-auto p-2">Edit
                                            Line</button>
                                        <div class="dropdown d-inline">
                                            <button
                                                class="ct_blue_btn ct_outline_btn_blue py-2 h-auto ct_fs_16 ct_fw_500 ct_white_nowrap w-auto d-flex align-items-center gap-1 p-2"
                                                type="button" id="actionMenu" data-bs-toggle="dropdown"
                                                aria-expanded="false">
                                                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24"
                                                    viewBox="0 0 24 24">
                                                    <path fill="currentColor"
                                                        d="M4 18q-.425 0-.712-.288T3 17t.288-.712T4 16h16q.425 0 .713.288T21 17t-.288.713T20 18zm0-5q-.425 0-.712-.288T3 12t.288-.712T4 11h16q.425 0 .713.288T21 12t-.288.713T20 13zm0-5q-.425 0-.712-.288T3 7t.288-.712T4 6h16q.425 0 .713.288T21 7t-.288.713T20 8z" />
                                                </svg>
                                                Action
                                                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24"
                                                    viewBox="0 0 24 24">
                                                    <path fill="currentColor" d="m12 16l-6-6h12z" />
                                                </svg>
                                            </button>
                                            <ul class="dropdown-menu" aria-labelledby="actionMenu">
                                                <li style="cursor: pointer;"><a class="dropdown-item" >Delete Line</a></li>
                                                <!-- <li><a class="dropdown-item" href="#">Option 2</a></li> -->
                                            </ul>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

            </div>


            <!-- Bus Stops Section -->
            <div class="col-md-6 bus-stops-section">
                <div class="d-flex justify-content-between align-items-center mb-3">
                    <h3>Bus stops</h3>
                    <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#ct_add_route">+ Add Bus
                        Stop</button>
                </div>
                <p>Manage all bus stops that your lines go to. Click on a pin on the map to edit or delete an existing
                    stop.</p>

                <div class="image-container">
                    <div id="map" style="width: 100%; height: 400px;"></div>
                </div>
            </div>
        </div>
    </div>

</div>




<!-- All Modal Section S -->

<!-- Add Modal S -->
<div class="modal fade" id="ct_add_route" tabindex="-1" aria-labelledby="ct_add_routeLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal-lg">
        <div class="modal-content pb-4">
            <!-- <div class="modal-header border-0">
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div> -->
            <div class="modal-body border-0 pt-5">
                <div class="ct_edit_modal_cnt">
                    <h4 class="ct_fs_24 ct_fw_600 pb-3 mb-4 ct_border_btm1">Add Route</h4>
                    <form action="" class="pt-2">

                        <div class="form-group mb-4">
                            <label for="" class="ct_fs_18 ct_fw_500 mb-2">Drop-off Point<span
                                    class="ct_text_red">*</span></label>
                            <div class="form-group position-relative">

                                <input type="text" class="form-control ct_input ct_fs_18"
                                    placeholder="Enter contact number" [(ngModel)]="stopName"
                                    [ngModelOptions]="{standalone: true}">

                            </div>
                        </div>

                        <div class="form-group mb-4 position-relative">
                            <label for="" class="ct_fs_18 ct_fw_500 mb-2">Terminal Name<span
                                    class="ct_text_red">*</span></label>
                            <input type="text" class="form-control ct_input ct_fs_18" placeholder="Enter Terminal Name"
                                [(ngModel)]="terminalName" [ngModelOptions]="{standalone: true}"
                                (keyup)="searchTerminal()" (blur)="onBlur()">

                            <p *ngIf="!terminalName && isTouched" class="err_msg">
                                This field cannot be empty
                                <svg width="13" height="13" viewBox="0 0 17 17" fill="none"
                                    xmlns="http://www.w3.org/2000/svg">
                                    <path
                                        d="M7.65 11.05H9.35V12.75H7.65V11.05ZM7.65 4.25H9.35V9.35H7.65V4.25ZM8.4915 4.25039e-06C6.81072 0.00168503 5.16817 0.501629 3.77147 1.43664C2.37478 2.37166 1.28663 3.69976 0.644591 5.25308C0.00254921 6.8064 -0.164567 8.5152 0.164367 10.1635C0.4933 11.8118 1.30352 13.3255 2.4926 14.5134C3.68168 15.7013 5.19625 16.51 6.84486 16.8373C8.49346 17.1646 10.2021 16.9958 11.7548 16.3522C13.3074 15.7086 14.6345 14.6191 15.5681 13.2215C16.5017 11.8238 17 10.1808 17 8.5C17 7.38305 16.7799 6.27705 16.3522 5.24523C15.9245 4.21341 15.2976 3.276 14.5074 2.48659C13.7172 1.69718 12.7792 1.07125 11.7469 0.644587C10.7147 0.217922 9.60845 -0.0011127 8.4915 4.25039e-06ZM8.5 15.3C7.15509 15.3 5.84038 14.9012 4.72213 14.154C3.60387 13.4068 2.7323 12.3448 2.21762 11.1022C1.70295 9.85971 1.56828 8.49246 1.83066 7.17339C2.09304 5.85432 2.74068 4.64267 3.69168 3.69168C4.64267 2.74068 5.85432 2.09304 7.17339 1.83066C8.49246 1.56828 9.85971 1.70295 11.1022 2.21762C12.3448 2.7323 13.4068 3.60387 14.154 4.72213C14.9012 5.84038 15.3 7.15509 15.3 8.5C15.3 10.3035 14.5836 12.0331 13.3083 13.3083C12.0331 14.5836 10.3035 15.3 8.5 15.3Z"
                                        fill="#F80000" />
                                </svg>
                            </p>

                            @if(isSearchActiveFrom){
                            <div class="ct_suggstion_search">
                                <ul>
                                    @if(allTerminalsList?.length > 0){
                                    @for (item of allTerminalsList; track $index) {
                                    <div (click)="searchByFromCity(item)" style="cursor: pointer;">
                                        <h6 class="mb-1 mt-1 ct_fw_600">{{item.description}}</h6>
                                        <!-- <p class=" mb-3 ct_fs_14">{{item.country_name}} </p> -->
                                    </div>
                                    }
                                    } @else {
                                    <li> <img src="assets/img/Search_icon.svg" alt="">Not found
                                    </li>
                                    }
                                </ul>
                            </div>
                            }

                        </div>

                    </form>

                </div>
            </div>
            <div class="modal-footer border-0 justify-content-end">
                <button type="button" class="ct_blue_btn ct_outline_btn_blue ct_fw_400"
                    data-bs-dismiss="modal">Cancel</button>
                <button hidden type="button" class="btn btn-secondary" #closeModal
                    data-bs-dismiss="modal">Close</button>
                <button type="button" (click)="addTerminal()" class="ct_blue_btn py-2 ct_fw_400">Add Terminal</button>
            </div>
        </div>
    </div>
</div>
<!-- Add Modal  E -->

<!-- All Modal Section E -->

<div *ngIf="loading">
    <app-loader />
</div>