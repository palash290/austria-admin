<div class="">
    <!-- <div class="ct_dash_header">
        <div class="d-flex align-items-center gap-3">
            <div class="ct_toggle_bar">
                <i class="fa-solid fa-bars"></i>
            </div>
        </div>
        <div class="ct_profile_drop">
            <app-header />
        </div>
    </div> -->
    <div class="ct_middle_content">

        <div class="ct_bus_grey_table">
            <div class="d-flex align-items-center justify-content-between gap-3 ct_pb_20 ct_px_20 flex-wrap">
                <!-- <h4 class="ct_fs_20 ct_fw_600 mb-0  ">Passenger Types</h4> -->
                <div class="d-flex gap-3 align-items-center  justify-content-between">
                    <select class="form-control w-auto" (change)="onBusChange($event)">
                        <option value="" disabled selected>-- Select --</option>
                        <!-- <option value="1">All</option> -->
                        <option *ngFor="let lan of stopNames" [value]="lan.startPointCityId">{{lan.start_city_name}}
                        </option>
                    </select>
                </div>
                <div class="d-flex gap-3 align-items-center  justify-content-between">
                    <!-- <input type="text" placeholder="Search..." class="form-control w-auto" [(ngModel)]="searchQuery"
                        (ngModelChange)="getType()"> -->
                    <button
                        class="ct_blue_btn ct_outline_btn_blue py-2 h-auto ct_fs_16 ct_fw_500 ct_white_nowrap w-auto ms-sm-auto"
                        data-bs-toggle="modal" data-bs-target="#ct_add_bus">
                        +
                        Add Ticket Type</button>
                </div>

            </div>
            <div class="table-responsive">
                <!-- <table class="table mb-0">
                    <thead>
                        <tr>
                            <th>Routes</th>
                            <th *ngFor="let header of data">
                                {{ header.ticket_type }}
                                <button class="ct_action_btn" data-bs-toggle="modal"
                                    (click)="patchUpdate(header.ticket_type_id)" data-bs-target="#ct_delete_modal">
                                    <svg width="20" height="20" viewBox="0 0 25 25" fill="none"
                                        xmlns="http://www.w3.org/2000/svg">
                                        <path
                                            d="M15.0447 9.86869L14.6987 18.8687M9.91069 18.8687L9.56469 9.86869M19.5327 6.65869C19.8747 6.71069 20.2147 6.76569 20.5547 6.82469M19.5327 6.65869L18.4647 20.5417C18.4211 21.1069 18.1658 21.6349 17.7497 22.0199C17.3337 22.405 16.7876 22.6189 16.2207 22.6187H8.38869C7.82178 22.6189 7.27571 22.405 6.85967 22.0199C6.44362 21.6349 6.18828 21.1069 6.14469 20.5417L5.07669 6.65869M19.5327 6.65869C18.3786 6.4842 17.2185 6.35178 16.0547 6.26169M5.07669 6.65869C4.73469 6.70969 4.39469 6.76469 4.05469 6.82369M5.07669 6.65869C6.23082 6.4842 7.39092 6.35178 8.55469 6.26169M16.0547 6.26169V5.34569C16.0547 4.16569 15.1447 3.18169 13.9647 3.14469C12.8583 3.10932 11.7511 3.10932 10.6447 3.14469C9.46469 3.18169 8.55469 4.16669 8.55469 5.34569V6.26169M16.0547 6.26169C13.5584 6.06876 11.051 6.06876 8.55469 6.26169"
                                            stroke="#EF331E" stroke-width="1.5" stroke-linecap="round"
                                            stroke-linejoin="round" />
                                    </svg>
                                </button>
                            </th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr *ngFor="let item of allRoutes; let i = index">
                            <td>{{item.pickup_point.city_name}} - {{item.dropoff_point.city_name}}</td>
                            <td><input type="text" placeholder="Type Input" *ngFor="let header of data"></td>
                        </tr>
                    </tbody>
                </table> -->

                <table class="table mb-0">
                    <thead>
                        <!-- <tr>
                            <th>Routes</th>
                            <th *ngFor="let ticketType of ticketTypes">{{ ticketType }}</th>
                        </tr> -->
                        <tr>
                            <th>Routes</th>
                            <th>Status</th>
                            <th *ngFor="let ticketType of ticketTypes">
                                <span *ngIf="ticketType.COLUMN_NAME == 'Baseprice'">{{ ticketType.COLUMN_NAME }}</span>
                                <span *ngIf="ticketType.COLUMN_NAME !== 'Baseprice'">
                                    {{ ticketType.COLUMN_NAME }}
                                    <!-- <button
                                  class="btn btn-sm btn-danger ms-2"
                                  (click)="deleteTicketType(ticketType)">
                                  Delete
                                </button> -->
                                    <button class="ct_action_btn" data-bs-toggle="modal"
                                        (click)="patchUpdate(ticketType.COLUMN_NAME)" data-bs-target="#ct_delete_modal">
                                        <svg width="20" height="20" viewBox="0 0 25 25" fill="none"
                                            xmlns="http://www.w3.org/2000/svg">
                                            <path
                                                d="M15.0447 9.86869L14.6987 18.8687M9.91069 18.8687L9.56469 9.86869M19.5327 6.65869C19.8747 6.71069 20.2147 6.76569 20.5547 6.82469M19.5327 6.65869L18.4647 20.5417C18.4211 21.1069 18.1658 21.6349 17.7497 22.0199C17.3337 22.405 16.7876 22.6189 16.2207 22.6187H8.38869C7.82178 22.6189 7.27571 22.405 6.85967 22.0199C6.44362 21.6349 6.18828 21.1069 6.14469 20.5417L5.07669 6.65869M19.5327 6.65869C18.3786 6.4842 17.2185 6.35178 16.0547 6.26169M5.07669 6.65869C4.73469 6.70969 4.39469 6.76469 4.05469 6.82369M5.07669 6.65869C6.23082 6.4842 7.39092 6.35178 8.55469 6.26169M16.0547 6.26169V5.34569C16.0547 4.16569 15.1447 3.18169 13.9647 3.14469C12.8583 3.10932 11.7511 3.10932 10.6447 3.14469C9.46469 3.18169 8.55469 4.16669 8.55469 5.34569V6.26169M16.0547 6.26169C13.5584 6.06876 11.051 6.06876 8.55469 6.26169"
                                                stroke="#EF331E" stroke-width="1.5" stroke-linecap="round"
                                                stroke-linejoin="round" />
                                        </svg>
                                    </button>
                                </span>
                            </th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr *ngFor="let route of allRoutes">
                            <!-- Route Information -->
                            <td>{{ route.start_city_name }} - {{route.end_city_name}} </td>
                            <td>
                                <div class="mb-3">
                                    <label class="form-label">Available</label>
                                    <div>
                                        <label class="switch ct_custom_switch1">
                                            <input type="checkbox" [(ngModel)]="route.is_active"
                                                [ngModelOptions]="{ standalone: true }"
                                                (click)="statusChange(route, route.is_active)" />

                                            <span class="slider"></span>
                                            <span class="text on ">NOT AVAILABLE</span>
                                            <span class="text off">AVAILABLE</span>
                                        </label>
                                    </div>
                                </div>
                            </td>
                            <!-- Dynamic Ticket Types -->
                            <td *ngFor="let ticketType of ticketTypes">
                                @if(route.is_active){
                                <input type="number" class="form-control"
                                    [placeholder]="ticketType.COLUMN_NAME + ' Price'"
                                    [(ngModel)]="route[ticketType.COLUMN_NAME]"
                                    [ngClass]="{ 'border-danger': ticketType.COLUMN_NAME[ticketType.COLUMN_NAME] < 0 }"
                                    (ngModelChange)="updateTicketPrice(route, ticketType.COLUMN_NAME, $event)"
                                    [min]="0" />
                                } @else {
                                <!-- Show disabled state or message when unavailable -->
                                <span class="text-muted">
                                    Not Available
                                </span>
                                }
                            </td>
                        </tr>
                    </tbody>
                </table>

                <!-- <div class="mt-3">
                    <button class="btn btn-primary" (click)="updateAllTicketPrices()">Update All</button>
                </div> -->

                <!-- <div *ngIf="data1?.length == 0 || !data1" class="text-center">
                    <p class="ct_fs_15 mt-3">No items found</p>
                </div> -->
            </div>
        </div>
        <div class="actions mt-3 d-flex align-items-center justify-content-end">
            <button (click)="saveUpdatedTicketPrices()" class="ct_blue_btn" type="submit">Save</button>
            <button (click)="cancel()" type="button" class="ct_blue_btn ct_cancle_btn_3">Cancel</button>
        </div>
    </div>
</div>







<!-- Add Modal S -->
<div class="modal fade " id="ct_add_bus" tabindex="-1" aria-labelledby="ct_edit_modalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal-lg">
        <div class="modal-content pb-4">
            <div class="modal-header border-0">
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body border-0 pt-0">
                <div class="ct_edit_modal_cnt">
                    <h4 class="ct_fs_24 ct_fw_600 text-center">Add Ticket Type</h4>
                    <form [formGroup]="form" class="pt-2">
                        <div class="form-group mb-4">
                            <label for="" class="ct_fs_18 ct_fw_500 mb-2">Ticket Type</label>
                            <input type="text" placeholder="Enter Ticket Type" formControlName="busName"
                                class="form-control ct_input ct_fs_18">

                            <p *ngIf="form.get('busName')?.touched && form.get('busName')?.errors" class="err_msg">
                                {{ getErrorMessage('busName') }}
                            </p>
                        </div>
                    </form>
                </div>
            </div>
            <div class="modal-footer border-0 justify-content-center">
                <button type="button" class="ct_blue_btn py-3" (click)="addType()">Add Category</button>
                <button hidden type="button" class="btn btn-secondary" #closeModal
                    data-bs-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>
<!-- Add Modal E -->




<!-- delete Modal S -->
<div class="modal fade" id="ct_delete_modal" tabindex="-1" aria-labelledby="ct_delete_modalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content pb-4">
            <div class="modal-header border-0">
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body border-0 pt-0">
                <div class="ct_delete_modal_cnt">
                    <div class="text-center mb-4 ct_delete_icon">
                        <svg width="40" height="40" viewBox="0 0 25 25" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path
                                d="M15.0447 9.86869L14.6987 18.8687M9.91069 18.8687L9.56469 9.86869M19.5327 6.65869C19.8747 6.71069 20.2147 6.76569 20.5547 6.82469M19.5327 6.65869L18.4647 20.5417C18.4211 21.1069 18.1658 21.6349 17.7497 22.0199C17.3337 22.405 16.7876 22.6189 16.2207 22.6187H8.38869C7.82178 22.6189 7.27571 22.405 6.85967 22.0199C6.44362 21.6349 6.18828 21.1069 6.14469 20.5417L5.07669 6.65869M19.5327 6.65869C18.3786 6.4842 17.2185 6.35178 16.0547 6.26169M5.07669 6.65869C4.73469 6.70969 4.39469 6.76469 4.05469 6.82369M5.07669 6.65869C6.23082 6.4842 7.39092 6.35178 8.55469 6.26169M16.0547 6.26169V5.34569C16.0547 4.16569 15.1447 3.18169 13.9647 3.14469C12.8583 3.10932 11.7511 3.10932 10.6447 3.14469C9.46469 3.18169 8.55469 4.16669 8.55469 5.34569V6.26169M16.0547 6.26169C13.5584 6.06876 11.051 6.06876 8.55469 6.26169"
                                stroke="#EF331E" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" />
                        </svg>
                    </div>
                    <h4 class="ct_fs_28 mb-3 ct_fw_600 text-center text-center">Confirm Delete</h4>
                    <p class="mb-0 text-center ct_fs_18"> Are you sure? you want to delete it.</p>


                </div>
            </div>
            <div class="modal-footer border-0 justify-content-center">
                <button type="button" class="ct_btn_red bg-danger py-3 px-5" data-bs-dismiss="modal">Cancel</button>

                <button (click)="deleteTicketType()" type="button" class="ct_blue_btn py-3 px-5">Confirm</button>
                <button hidden type="button" class="btn btn-secondary" #closeModal2
                    data-bs-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>
<!-- delete Modal E -->

<div *ngIf="loading">
    <app-loader />
</div>